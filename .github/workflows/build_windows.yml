name: build_windows

# Triggered on push/pr against master.
on:
  push:
    branches: [ windows ]
  pull_request:
    branches: [ windows ]

jobs:
  build:
    # @todo -alternatively run on a docker container which already has dependencies installed.
    runs-on:  ${{ matrix.os }}
    strategy:
      matrix:
        os: [windows-2019]
        cuda: [10.2.89]
    env:
      cuda: ${{ matrix.cuda }} 
      cuda_packages: "nvcc;visual_studio_integration;curand_dev;nvrtc_dev;"

    steps:
    # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
    - uses: actions/checkout@v2


    - name: get_os
      run: |
        echo "${{ matrix.os }}"
        echo "${{ matrix.cuda }}"


    - name: install_cuda
      run: |
        echo "env.cuda ${{ env.cuda }}"
        .\scripts\install_cuda_windows.ps1
        # Set paths for subsequent steps, using the environment variable set by the script.
        echo "::set-env name=CUDA_PATH::$env:CUDA_PATH"
        echo "::add-path::$env:CUDA_PATH/bin"
        echo "Using CUDA_PATH $env:CUDA_PATH"
      shell: powershell

    - name: check_paths
      run: | 
        echo $PATH
        echo $CUDA_PATH
      shell: bash        

    - name: returntest
      run: |
        $cuda_path=""
        if($cuda_path.length -eq 0) { return 1}

    
    # - name: test_nvcc
    #   run: |
    #     echo $PATH
    #     nvcc -V
    #   shell: bash
